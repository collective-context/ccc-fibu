/*╔═════════════════════════════════════════════════════════════════════════╗
  ║  Programme-Name: BA_SAA.C        Revision: 1.3         (C) 1989/1991    ║
  ║  Function      : euroSOFT Basisprogramm                                 ║
  ║                                                                         ║
  ║  Rev.-Date     : 01.05.1991, Graz           Update: 16.07.1991, Graz    ║
  ║  Author        : Peter Mayer                Author: Peter Mayer         ║
  ║  Copyright (C) : euroSOFT-WAREengineering,  Peter Mayer, A-8010 Graz    ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/
/*╔═════════════════════════════════════════════════════════════════════════╗
  ║     Application_Mask()                                                  ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/
GLOBAL
WORD Application_Mask()
{
ReadSelect();
Read_Default();
while(!wFinis_g)                                     /* Haupt-Eingabe-Schl.  */
  {
  Set_Default();

  while(wKeyCode_g!=9999 && !wEscFlag_g)             /* ESC-Taste gedrückt   */
    {
    M_KeyCode(apWkbMask_g, wKeyCode_g,               /* Für Application_Set  */
      &wNextMaskNumber, &wNextFieldNumber,
      &wNextBlockNumber_g, apTextBox_g,
      apstrRecord_g, awRecLength_g, awBlocks_g );    /* Key-Code auswerten   */

    Application_Set(wNextMaskNumber,
      wNextFieldNumber);                             /* Vorbelegungen        */

    if(boInput_g) M_Input(apWkbMask_g,               /* Masken-Interpreter   */
      &wMaskNumber_g, apstrRecord_g, apstrMaskText_g,/*                      */
      apstrBrowseText_g,apTextBox_g,&wFieldNumber_g, /*                      */
      strOldString_g, strNewString_g, &wKeyCode_g,   /*                      */
      awBlocks_g, awScroll_g, awRecLength_g,         /*                      */
      &wBlockNumber_g, strApp_g, pstrIndexKey_g);    /*                      */

    KeyCode_Handler();
    if(strchr(strSpecialKeyCodes_g,wKeyCode_g ) > 0) /* Wenn Funktionstaste  */
      Special_Functions();                           /* gedrückt dann aus-   */
    else                                             /* werten sonst:        */
      {                                              /* Feldnummer auf Key-  */
      Field_Classification();                        /* Feld prüfen          */
      if(wRecKey_g>0 && boRecMask_g)                 /* Wenn Stammschlüssel  */
        Record_Key_Handler();                        /* dann abhandeln       */
      else                                           /* sonst: wenn Referenz-*/
        if(wRefKey_g>0)                              /* schlüssel dann such  */
          Reference_Key_Handler();                   /* Referenzdatei        */
        else                                         /* sonst: andere Felder */
          Other_Fields_Handler();                    /* abhandeln            */

      } /*end ! strSpecialKeyCodes */                /*                      */

    All_Fields_Handler();
    } /*end: while(!wEscFlag_g)*/

  wOkAbort=Store();                                  /* satz speichern       */
  } /*end while(wFinis_g)*/                          /* !wFinis dann Eingabe */

return(OK);
} /*end Application_Mask() */

#pragma optimize("q", on)   /* P-Code ein */

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Special_Functions()                                                     ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Diese Routine wird angesprungen, wenn vom Anwender eine Sonderfunk-     ║
  ║ tionstaste betätigt wurde, die für die Applikation eine bestimmte       ║
  ║ Bedeutung hat.                                                          ║
  ║ Siehe Konstanten-Deklaration                                            ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Field_Classification()                                                  ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Field_Classification() teilt das vom Anwender gerade verlassene Feld in ║
  ║ eine der Kategorien "Schlüssel zum Stammsatz", "Schlüsselfeld mit Ver-  ║
  ║ weis auf eine Referenzdatei" oder "allgemeines Stammdatenfeld" ein.     ║
  ║ Soll die Eingabe bei einem Verweis auf eine Reference-Datei sich nicht  ║
  ║ auf den Primarkey in der Reference-Datei beziehen, so muß dies in der   ║
  ║ Sub-Funktion i_Field_Classification nachgetragen werden.                ║
  ║ Auch bei scrollbaren Zeilen im Maskentyp 1 muße bei einem Verweis auf   ║
  ║ Reference-Dateien der Eintrag in i_Field_Classification() erfolgen.     ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Copy_Selection()                                                        ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Diese Funktion wird nach drücken der [F2]-Taste nach Ausführung der     ║
  ║ Funktion Matchcode_Handler() in der Funktion Special_Funktions() vor    ║
  ║ der Funktion Reference_Key_Handler() aufgerufen.                        ║
  ║ Weiters wird die Funktion in der Funktion Field_Classification() und    ║
  ║ damit ebenfalls vor Reference_Key_Handler() aufgerufen.                 ║
  ║ Aufgabe:                                                                ║
  ║   1) In der Funktion Matchcode_Handler wird nach einem beliebigen       ║
  ║      Schlüssel in der angebenen Datei gesucht. Unter strSelection_g     ║
  ║      wird vom gewählten Datensatz der Primärkey der Datei zurückgegeben.║
  ║ oder: (R-2)                                                             ║
  ║   2) In der Funktion Field_Classification() wird nach einem beliebigen  ║
  ║      Schlüssel in der angebenen Datei gesucht. Unter strSelection_g     ║
  ║      wird vom gewählten Datensatz der Primärkey der Datei zurückgegeben.║
  ║ In beiden Fällen kopiert diese Funktion strSelection_g an die Primarkey-║
  ║ stelle des Records sowie auf die Varaiblen strKey_Value_g und strNew-   ║
  ║ string_g.                                                               ║
  ║ Danach steht der Primärkey nach der Wahl für die Funktion Referenc_Key- ║
  ║ Handler() an der richtigen Stelle.                                      ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Record_Key_Handler()                                                    ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Diese Routine behandelt die Eingaben, die in einem Schlüsselfeld        ║
  ║ zum Stammsatz gemacht wurden.                                           ║
  ║ Hier wird überprüft, ob der Schlüssel Gültigkeit besitzt und in         ║
  ║ der Stammdaten-Datei vorhanden ist. Danach wird entschieden, ob ein     ║
  ║ bestehender Satz mutiert werden soll, oder ob ein neuer Satz ange-      ║
  ║ legt werden soll.                                                       ║
  ║ Bei Leereingaben ohne aktuellen Datensatz wird in das nächste           ║
  ║ Schlüsselfeld zum Stammdaten-Satz verzweigt.                            ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Primary_KeyHandler()                                                    ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Diese Funktion wird aufgerufen, wenn das Primärkeyfeld verlassen wird.  ║
  ║ Der Primary_KeyHandler wird auch in einem Rec-Schlüsselfeld nach dem    ║
  ║ Drücken der [F2]-Taste angesprungen.                                    ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Reference_Key_Handler()                                                 ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Reference_Key_Handler() behandelt die Eingaben, die in einem Schlüssel- ║
  ║ feld auf eine Referenz-Datei gemacht wurden.                            ║
  ║ Es werden Referenz-Zugriffe (sofern erwünscht) auf die jeweiligen       ║
  ║ Dateien vorgenommen.                                                    ║
  ║ Der laut Field_Classification() oder Matchcode_Handler gewählte Primär- ║
  ║ key in der Reference-Datei wird geladen.                                ║
  ║ In i_Reference_Key_Handler() können etwaige Feldzuordnungen nachgetra-  ║
  ║ gen werden.                                                             ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Next_Key_Field ()                                                       ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Diese Routine setzt den Feld-Cursor auf das nächste Schlüsselfeld.      ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Matchcode_Handler()                                                     ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Matchcode_Handler() behandelt die Matchcode-Anfragen zu Key-Feldern.    ║
  ║ Für scrollbare Zeilen im Maskentyp 1 und für spezielle Wünsche bei      ║
  ║ Zugriffen auf Referenz-Dateien können in i_Matchcode_Handler() Einträge ║
  ║ erfolgen.                                                               ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ i_Read_Default()                                                        ║
  ║ ─────────────────────────────────────────────────────────────────────── ║
  ║ Legt fest, ob beim Aufruf eines Programmes bereits ein Datensatz gele-  ║
  ║ sen werden soll.                                                        ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/
