// (C) WINware Software P.Mayer: letztes Update am 12-Feb-1996

/********************************/
/* Dieses Programm leitet die   */
/* <PrtSc>-Taste um             */
/* Diskettenname: anhresi2      */
/********************************/
#include <eur_tool.h>
#include <dos.h>
#include <stdlib.h>
#include <malloc.h>
#include <io.h>
#include <fcntl.h>
/*#include <tool1.h>*/

#define PRT_TASTE   0x05
#define S_IWRITE    0000200         /* write permission, owner */

VOID main(VOID);
VOID far* interrupt ScreenToFile(VOID);
VOID far* interrupt Nachricht(VOID);

MGLOBAL SWORD	i=0;
MGLOBAL SWORD	wBr=0;
MGLOBAL SWORD	wDelta=0;
MGLOBAL SWORD	wSpalte=0;
MGLOBAL SWORD	wZeile=0;
MGLOBAL SWORD	wBreite=80;
MGLOBAL SWORD	wHoehe=25;
MGLOBAL FPWORD fpwZiel=NULL;
MGLOBAL FPWORD fpwTmp_m=NULL;
MGLOBAL FPWORD fpwScreen_m=NULL;

MGLOBAL PSWORD	pwBegin=NULL,
	       pwEnd=NULL;
MGLOBAL SWORD	wSize=0;
MGLOBAL SWORD	wFileHandle=1;

MGLOBAL CHAR   strBild[]={"BILD0000.PIC        "};

MGLOBAL SWORD	awScreenBuffer[]=
  {
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,
  48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48
  };


/*******************************/
/* Hauptprogramm               */
/*******************************/
VOID main()
{
fpwScreen_m = MK_FP(0xb000,0);		  /* für Hercules-Karte 0xb000,0    */
					  /* für EGA-Karte o.ä. 0xb800,0    */

pwBegin = &_psp;			  /*Programmganfang*/
pwEnd	= sbrk(0);			  /*Programmende   */
wSize	= (pwEnd - pwBegin + 15) / 16;	  /*Programmgröße  */

_dos_setvect(PRT_TASTE,  ScreenToFile);
/*_dos_setvect(PRT_TASTE,  Nachricht);*/

_dos_keep(0, wSize);
}


/*.ta ScreenToFile() - ( vgl. Vi_Sw2b() )
╔══════════════════════════════════════════════════════════════════════════════╗
║  Vi_Sw2b()                                                                   ║
╚══════════════════════════════════════════════════════════════════════════════╝

Überblick:
────────────────────────────────────────────────────────────────────────────────
#include <eur_vio.h>
VOID Vi_Sw2b(wSpalte, wZeile, wBreite, wHoehe, fpwZiel);

Parameter:
────────────────────────────────────────────────────────────────────────────────

Beschreibung:
────────────────────────────────────────────────────────────────────────────────
Die Funktion schreibt den Inhalt des Fensters, das durch die Koordinaten seiner
linken oberen Ecke und seiner Ausdehnung in horizontaler und vertikaler Richtung
festgelegt werden kann, in einen Buffer, auf den der Zeiger »fpwZiel« zeigt. Das
Fenster wird zeilenweise in dem Buffer abgelegt.

Der Benutzer muß dafür sorgen, daß der Buffer groß genug ist, um das Fenster
aufzunehmen.

Um eine maximale Geschwindigkeit zu erzielen, verzichtet die Funktion auf eine
Überprüfung der Parameter.


Rückgabewert:
────────────────────────────────────────────────────────────────────────────────
Diese Funktion hat keinen Rückgabewert.

siehe auch:
────────────────────────────────────────────────────────────────────────────────
Vi_Sb2w(), Vi_Seite()

Beispiel:
────────────────────────────────────────────────────────────────────────────────
Den Einsatz dieser Funktion können Sie in dem Beispielprogramm »Vi_Demo.c«
studieren. »Vi_Sw2b()« wird dort in der Funktion »main()« aufgerufen, um den
Bildschirminhalt zu sichern.

.te*/

/*╔═════════════════════════════════════════════════════════════════════════╗
  ║ Funktions-Deklaration						    ║
  ╚═════════════════════════════════════════════════════════════════════════╝*/
VOID far* interrupt ScreenToFile()
{
fpwZiel=awScreenBuffer;

wDelta = 80 - wBreite;				    /* Hilfsgröße	    */
    fpwTmp_m = fpwScreen_m + wZeile*80 + wSpalte;   /* Zeiger auf die linke */
                                                    /* obere Ecke.          */
    for (;wHoehe>0; wHoehe--, fpwTmp_m += wDelta)   /* Zeilen abarbeiten    */
	for(wBr=wBreite; wBr>0; wBr--)		    /* Spalten abarbeiten   */
            *fpwZiel++ = *fpwTmp_m++;               /* Z. und A. in Buffer  */
                                                    /* schreiben.           */
i++; if(i>99) i=1;
if(i<10)
  strBild[7]=(CHAR)i+48;
else {
  strBild[6]=(CHAR)(i/10)+48;
  strBild[7]=(CHAR)(i%10)+48; }

wFileHandle=open(strBild, O_CREAT|O_WRONLY|O_BINARY, S_IWRITE);
  /*exit (ERROR);*/

write(wFileHandle, (PCHAR) awScreenBuffer, 4000);

close(wFileHandle);
  /*printf ("\nBild-Datei <%s> kann nicht geschlossen werden", strBild);*/
  /*exit (ERROR);*/

}
