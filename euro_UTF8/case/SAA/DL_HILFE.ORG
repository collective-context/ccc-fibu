/*.ta Dl_Hilfe()
╔══════════════════════════════════════════════════════════════════════════════╗
║  Dl_Hilfe()                                                                  ║
╚══════════════════════════════════════════════════════════════════════════════╝

Überblick:                                                             20.11.89
────────────────────────────────────────────────────────────────────────────────
#include <eur_dl.h>
WORD Dl_Hilfe(pstrTitel, ppstrText);

Parameter:
────────────────────────────────────────────────────────────────────────────────
PSTR   pstrTitel   Zeiger auf String, der Titel des Hilfe-Fensters enthält
PPSTR  ppstrText   Zeiger auf Zeiger mit dem Hilfetext

Beschreibung:
────────────────────────────────────────────────────────────────────────────────
Diese Funktion baut ein Dialog-Fenster für Hilfsinformationen auf. Die Position
der linken oberen Ecke ist Spalte 11, Zeile 9. Das Fenster ist insgesamt
14 Zeilen hoch und 56 Spalten breit.

In Spalte 0 des Fensters wird der der Funktion übergebene Parameter pstrTitel
als Titel ausgegegeben.

Eine Textzeile sollte maximal 52 Zeichen beinhalten. Kennzeichnen Sie das Ende
der Liste mit einem NULL-Zeiger.

Wenn der Hilfetext mehr als acht Zeilen umfaßt, stellt die Funktion dem
Anwender eine Scroll-Möglichkeit zur Verfügung. Die mögliche Scroll-Richtung
wird auf der Trennlinie unterhalb der Titelzeile durch die Anzeige von Rich-
tungspfeilen kenntlich gemacht. Das Scrollen ist dann mit den Cursortasten nach
oben und unten möglich.

Im unteren Bereich der Dialogbox befinden sich zwei Schaltflächen. Mit der
Esc-Schaltfläche kann der Anwender die Hilfe beenden. Mit der F1-Schaltfläche
kann Hilfe zur Bedienung der Dialogbox angefordert werden, die von der Toolbox
zur Verfügung gestellt wird.

Eine aktive Maus wird automatisch unterstützt. Der Anwender kann dann die
Schaltflächen aktivieren, indem er mit dem Mauszeiger auf die gewünschte Schalt-
fläche zeigt und die linke Maustaste drückt. Das Scrollen wird durch Zeigen auf
die Scroll-Pfeile und drücken der linken Maustaste aktiviert.

Sie können diese Funktion auch u.a. auch dazu verwenden, um ein Hilfefenster
für die von Ihrem Programm benutzte Tastaturbelegung aufzubauen, das der SAA-
Standard vorsieht. Bieten Sie dann dem Anwender mit der Taste [F9] Zugang zu
diesem Hilfsfenster. Diese Tastenbelegung wird sowohl in der Shell von DOS 4.0
als auch im Session-Manager von OS/2 verwendet.


Rückgabewert:
────────────────────────────────────────────────────────────────────────────────
WORD  Fehlerinformation OK/ERROR


Benutzte globale Variablen (R/W):
────────────────────────────────────────────────────────────────────────────────
Variablen (R/W):  - aCS_g[]    (R)           - pstrEsc_g   (R)
                  - wCSInd_g   (R)           - pstrF1_g    (R)
                  - wMausda_g  (R)           - boBeepen_g  (R)
.ff
.de \euro\demo\dmohilf1.c
.te*/

/*╔════════════════════════════════════════════════════════════════════════╗
  ║                        DEKLARATIONS-DATEIEN                            ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
#include <eur_tool.h>
#include <stdio.h>
#include <string.h>
#include <dos.h>


/*╔════════════════════════════════════════════════════════════════════════╗
  ║             GLOBALE VARIABLEN, DEFINITION UND REFERENZEN               ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
IMPORT COLORSET aCS_g[];                            /* Farbpaletten-Array   */
IMPORT WORD     wCSInd_g;                           /* Index in Pal.-Array  */
IMPORT WORD     wMausda_g;                          /* Maus im System ?     */

IMPORT PSTR     pstrF1_g;                           /* Texte der Schalt-    */
IMPORT PSTR     pstrEsc_g;                          /* flächen              */
IMPORT PSTR     pstrReturn_g;
IMPORT BOOL     boBeepen_g;                         /* Warnton ein ?        */


/*╔════════════════════════════════════════════════════════════════════════╗
  ║                        KONSTANTEN UND MAKROS                           ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
#define ZEI   HILFEZEILE                            /* Zeile des Dialoges   */
#define SPA   (HILFESPALTE-8)                       /* Spalte des Dialoges  */
#define BRE        72                               /* Breite des Dialoges  */
#define HOE        14                               /* Höhe des Dialoges    */
#define SCR_DELAY   1              /* Zeitverzögerung für Maus-Dauer-Scroll */

#define PFEILOBENAN()       Wi_Sza(BRE-6,1,'',aCS_g[wCSInd_g].wCs_dlg_sp)
#define PFEILOBENAUS()      Wi_Sza(BRE-6,1,'─',aCS_g[wCSInd_g].wCs_dlg)

#define PFEILUNTENAN()      Wi_Sza(BRE-4,1,'',aCS_g[wCSInd_g].wCs_dlg_sp)
#define PFEILUNTENAUS()     Wi_Sza(BRE-4,1,'─',aCS_g[wCSInd_g].wCs_dlg)

#define ZEICHNEBALKEN(z)    Wi_Swa(1,z+2, BRE-4,1,aCS_g[wCSInd_g].wCs_mf_ca)
#define LOESCHEBALKEN(z)    Wi_Swa(1,z+2, BRE-4,1,aCS_g[wCSInd_g].wCs_dlg)



/*╔════════════════════════════════════════════════════════════════════════╗
  ║                        MODULGLOBALE VARIABLEN                          ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
STATIC	WORD   wStartzeile_m;
STATIC	WORD   wHilfsZeilen_m;
STATIC	WORD   wAktZeile_m=0;
STATIC	PPSTR  ppstrTmp_m;


/*╔════════════════════════════════════════════════════════════════════════╗
  ║                        MODULGLOBALE FUNKTIONEN                         ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
STATIC	VOID cdecl i_EineZeileHoch	  (VOID);
STATIC	VOID cdecl i_EineZeileRunter	  (PPSTR);


/*╔════════════════════════════════════════════════════════════════════════╗
  ║                          FUNKTIONS-DEFINITION                          ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
GLOBAL
WORD Dl_Hilfe(PSTR pstrTitel, PPSTR ppstrTxt)
{
    PWKB    pWkbDialog;
    EVENT   Event;
    PEVENT  pEvent;
    LONG    lPfeilTicks;

    i_InitVars();                                   /* glo. Var. init.      */

    if ((pWkbDialog=Wi_Einrichten(SPA,ZEI,BRE,HOE)) /* Fenster einrichten   */
        == NULL)
        return (ERROR);                             /* evtl. Abbruch        */

    i_Dl_Init(SPA, ZEI, BRE, HOE,
              pstrTitel,
              pWkbDialog,
              SF_ABBRUCH|SF_HILFE,
              DLG_INFO);

    pEvent = &Event;                                /* Var. initialisieren  */
    ppstrTmp_m = ppstrTxt;
    wStartzeile_m = 0;

    for (wHilfsZeilen_m=0;                          /* Anzahl der Hilfs-    */
         *ppstrTmp_m++ != NULL;                     /* zeilen ermitteln     */
         wHilfsZeilen_m++);
    ppstrTmp_m = ppstrTxt;                          /* Zeiger zurücksetzen  */

    if (wHilfsZeilen_m > TEXTZEILEN)                /* evtl. Scrollpfeil    */
        PFEILUNTENAN();                             /* einschalten          */

    i_Dl_HilfeSchreibeText(ppstrTmp_m);             /* Hilfstext ausgeben   */

    for(;;)                                         /* Eingaberoutine       */
    {
        Ut_Event(pEvent);
        switch(pEvent->wArt)
        {
           case EVENT_TASTE:
              switch(pEvent->wTaste)
              {
               case T_HOME:
                  if (wStartzeile_m != 0)
                  {
                     ppstrTmp_m = ppstrTxt;
                     wStartzeile_m = 0;
                     Wi_Swz(0,2,BRE-2,8,32);
                     i_Dl_HilfeSchreibeText(ppstrTmp_m);
                     if (wHilfsZeilen_m > TEXTZEILEN)
                     {
                        PFEILUNTENAN();
                        PFEILOBENAUS();
                     }
                  }
                  break;

               case T_END:
                  if (wStartzeile_m != wHilfsZeilen_m-MINZEILEN)
                  {
                     wStartzeile_m = wHilfsZeilen_m - MINZEILEN;
                     ppstrTmp_m    = ppstrTxt+wStartzeile_m;
                     Wi_Swz(0,2,BRE-2,8,32);
                     i_Dl_HilfeSchreibeText(ppstrTmp_m);

                     if (wHilfsZeilen_m > TEXTZEILEN)
                     {
                        PFEILUNTENAUS();
                        PFEILOBENAN();
                     }
                  }
                  break;

               case T_DOWN:
                  i_EineZeileHoch();
                  break;

               case T_UP:
                  i_EineZeileRunter(ppstrTxt);
                  break;

               case T_F1:
                  i_Dl_HilfeFuerHilfe();
                  break;

               case T_ESC:
                  Wi_Entfernen(pWkbDialog);
                  return(OK);

               default:
                  if (boBeepen_g)
                     i_Beep();
              } /* end of switch(pEvent->wTaste) */
              break;

           case EVENT_L_PRESS:
              if (pEvent->wZeile == (ZEI+2))
              {
                  if (pEvent->wSpalte == (SPA+51))
                  {
                      lPfeilTicks = pEvent->lTicks;
                      i_EineZeileRunter(ppstrTxt);
                  }
                  else if (pEvent->wSpalte == (SPA+53))
                  {
                      lPfeilTicks = pEvent->lTicks;
                      i_EineZeileHoch();
                  }
              }

              else if (pEvent->wZeile == (ZEI+12))
              {
                 if (pEvent->wSpalte > SPA+2 &&
                     pEvent->wSpalte < SPA+3+strlen(pstrEsc_g))
                 {
                    Wi_Entfernen(pWkbDialog);
                    return(OK);
                 }
                 else if (pEvent->wSpalte > SPA+16 &&
                       pEvent->wSpalte < SPA+17+strlen(pstrF1_g))
                 {
                    i_Dl_HilfeFuerHilfe();
                }
             }
              else if (boBeepen_g)
                 i_Beep();
             break;

           default:
             if (pEvent->wButton == MSM_L_DOWN &&
                 pEvent->lTicks-lPfeilTicks >= SCR_DELAY &&
                 pEvent->wZeile == (ZEI+2))
             {
                if (pEvent->wSpalte == (SPA+51))
                {
                    lPfeilTicks = pEvent->lTicks;
                    i_EineZeileRunter(ppstrTxt);
                }
                else if (pEvent->wSpalte == (SPA+53))
                {
                    lPfeilTicks = pEvent->lTicks;
                    i_EineZeileHoch();
                }
             }

        } /* end of switch(pEvent->wArt) */
    } /* end of for */
}


/*.ta i_EineZeileHoch
  ╔════════════════════════════════════════════════════════════════════════╗
  ║  Funktionsname:    i_EineZeileHoch                Datum: 25.10.88      ║
  Ã────────────────────────────────────────────────────────────────────────Â
  ║                                                                        ║
  ║  Parameter:        keine                                               ║
  ║                                                                        ║
  ║  Beschreibung:     Diese Funktion steuert das Scrollen und die  Neu-   ║
  ║                    ausgabe des Hilfstextes bei Dl_Hilfe().             ║
  ║                    Eine Aktion wird erst dann ausgeführt, wenn         ║
  ║                    mehr als die in der Konstante MINZEILEN angegebenen ║
  ║                    Zeilen noch im Fenster stehen.                      ║
  ║                    In diesem Fall wird der im Fenster stehende         ║
  ║                    Text gescrollt, der neue Text ausgegeben und        ║
  ║                    die Scroll-Pfeile an die nach dem Scrollen ent-     ║
  ║                    standene Situation angepaßt.                        ║
  ║                                                                        ║
  ║  Rückgabewert:     keine                                               ║
  ║                                                                        ║
  ║                                                                        ║
  ║  Benutzte globale                                                      ║
  ║  Variablen (R/W):  modulglobale Variablen:                             ║
  ║                    - wHilfsZeilen_m (R)                                ║
  ║                    - wStartzeile_m  (R/W)                              ║
  ║                    - ppstrTmp_m     (R)                                ║
  ║                                                                        ║
  ╚════════════════════════════════════════════════════════════════════════╝
.ff
.te*/
STATIC
VOID i_EineZeileHoch(VOID)
{
    if (wHilfsZeilen_m > TEXTZEILEN)
    {
        if (wStartzeile_m < (wHilfsZeilen_m - MINZEILEN) )
        {
            i_Dl_Scroll((SPA+1),(ZEI+3),(BRE+SPA-2),(ZEI+10),UP);

            i_Dl_HilfeSchreibeText(ppstrTmp_m+=1);
            wStartzeile_m++;
            if(wStartzeile_m != 0)
                PFEILOBENAN();
            if (wStartzeile_m == wHilfsZeilen_m - MINZEILEN)
                PFEILUNTENAUS();
        }
        else if (boBeepen_g)
            i_Beep();
    }

    return;
}




/*╔════════════════════════════════════════════════════════════════════════╗
  ║  Funktionsname:    i_EineZeileRunter              Datum: 25.10.88      ║
  Ã────────────────────────────────────────────────────────────────────────Â
  ║                                                                        ║
  ║  Parameter:        PPSTR ppstrTxt  Zeiger auf erste Zeile der          ║
  ║                                    Hilfstexte                          ║
  ║                                                                        ║
  ║  Beschreibung:     Diese Funktion steuert das Scrollen und die  Neu-   ║
  ║                    ausgabe des Hilfstextes bei Dl_Hilfe().             ║
  ║                    Eine Aktion wird erst dann ausgeführt, wenn         ║
  ║                    mehr als die in der Konstante MINZEILEN angegebenen ║
  ║                    Zeilen noch im Fenster stehen.                      ║
  ║                    In diesem Fall wird der im Fenster stehende         ║
  ║                    Text gescrollt, der neue Text ausgegeben und        ║
  ║                    die Scroll-Pfeile an die nach dem Scrollen ent-     ║
  ║                    standene Situation angepaßt.                        ║
  ║                                                                        ║
  ║  Rückgabewert:     Diese Funktion hat keinen Rückgabewert.             ║
  ║                                                                        ║
  ║  Benutzte globale                                                      ║
  ║  Variablen (R/W):  modulglobale Variablen:                             ║
  ║                    - wHilfsZeilen_m (R)                                ║
  ║                    - wStartzeile_m  (R/W)                              ║
  ║                    - ppstrTmp_m     (R)                                ║
  ║                                                                        ║
  ╚════════════════════════════════════════════════════════════════════════╝*/
STATIC
VOID i_EineZeileRunter(PPSTR ppstrTxt)
{
    if (wHilfsZeilen_m > TEXTZEILEN)
    {
        if (ppstrTmp_m != ppstrTxt)
        {
            i_Dl_Scroll((SPA+1),(ZEI+3),(BRE+SPA-2),(ZEI+10),DOWN);
            i_Dl_HilfeSchreibeText(ppstrTmp_m-=1);
            wStartzeile_m--;
            if (wStartzeile_m != wHilfsZeilen_m - MINZEILEN)
                PFEILUNTENAN();
            if (wStartzeile_m == 0)
                PFEILOBENAUS();
        }
        else if (boBeepen_g)
            i_Beep();
    }
    return;
}

